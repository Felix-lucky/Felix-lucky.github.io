(this.webpackJsonpjira=this.webpackJsonpjira||[]).push([[9],{453:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return Ce}));var a,r=n(173),c=n(0),i=n.n(c),l=n(423),o=n(426),u=n(174),d=n(31),m=n(424),s=n(425),b=n(41),f=n(97),v=n(112),p=n(98),E=n(429),O=function(e){var t=Object(p.c)(),n=Object(b.a)(Object(b.a)({},e),{},{name:Object(v.d)(null===e||void 0===e?void 0:e.name,200)});return Object(f.useQuery)(["tasks",Object(v.a)(n)],(function(){return t("tasks",{data:e})}))},j=n(430),k=function(){var e,t=null===(e=Object(l.g)().pathname.match(/projects\/(\d+)/))||void 0===e?void 0:e[1];return Number(t)},g=function(){return Object(s.d)(k())},y=function(){return{projectId:k()}},h=function(){return["kanbans",y()]},I=function(){var e=k(),t=Object(j.b)(["name","typeId","processorId","tagId"]),n=Object(d.a)(t,1)[0];return Object(c.useMemo)((function(){return{projectId:e,name:n.name||void 0,typeId:Number(n.typeId)||void 0,processorId:Number(n.processorId)||void 0,tagId:Number(n.tagId)||void 0}}),[e,n])},x=function(){return["tasks",I()]},w=function(){var e=Object(j.b)(["editTaskId"]),t=Object(d.a)(e,2),n=t[0].editTaskId,a=t[1],r=function(e){var t=Object(p.c)();return Object(f.useQuery)(["tasks",{id:e}],(function(){return t("tasks/".concat(e))}),{enabled:!!e})}(Number(n)),i=r.data,l=r.isLoading;return{startEdit:Object(c.useCallback)((function(e){a({editTaskId:e})}),[a]),isLoading:l,editTask:i,close:Object(c.useCallback)((function(){a({editTaskId:void 0})}),[a]),editTaskId:n}},T=function(e,t){var n=new RegExp("(".concat(t,")"),"g");return e.replace(n,'<span style="color: red">$1</span>')},C=n(454),M=n(176),L=n(422),N=function(){return{projectId:k()}},S=function(){return["epics",N()]},P=n(437),R=n.n(P),D=n(20),F=n.n(D),Y=n(51),A=n(419),V=n(421),H=n(420),Q=n(89),z=u.a.div(a||(a=Object(r.a)(["\n  min-height: 50vh;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n"]))),B=function(e){var t=A.a.useForm(),n=Object(d.a)(t,1)[0],a=function(e){var t=Object(p.c)();return Object(f.useMutation)((function(e){return t("epics",{method:"POST",data:e})}),Object(E.a)(e))}(S()),r=a.mutateAsync,c=a.isLoading,l=a.error,o=k(),u=function(){var e=Object(Y.a)(F.a.mark((function e(t){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(Object(b.a)(Object(b.a)({},t),{},{projectId:o}));case 2:m();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){n.resetFields(),e.onClose()};return i.a.createElement(V.a,{visible:e.visible,onClose:m,forceRender:!0,destroyOnClose:!0,width:"100%"},i.a.createElement(z,null,i.a.createElement("h1",null,"\u521b\u5efa\u4efb\u52a1\u7ec4"),i.a.createElement(Q.a,{error:l}),i.a.createElement(A.a,{form:n,layout:"vertical",onFinish:u,style:{width:"40rem"}},i.a.createElement(A.a.Item,{label:"\u4efb\u52a1\u540d",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"}]},i.a.createElement(H.a,{placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"})),i.a.createElement(A.a.Item,{style:{textAlign:"center"}},i.a.createElement(M.a,{loading:c,type:"primary",htmlType:"submit"},"\u63d0\u4ea4")))))};function K(){Object(v.e)("\u4efb\u52a1\u7ec4");var e=Object(c.useState)(!1),t=Object(d.a)(e,2),n=t[0],a=t[1],r=g().data,l=function(e){var t=Object(p.c)();return Object(f.useQuery)(["epics",Object(v.a)(e)],(function(){return t("epics",{data:e})}))}(N()).data,u=O({projectId:null===r||void 0===r?void 0:r.id}).data,s=function(e){var t=Object(p.c)();return Object(f.useMutation)((function(e){return t("epics/".concat(e),{method:"DELETE"})}),Object(E.b)(e))}(S()).mutate;return i.a.createElement(m.c,null,i.a.createElement(m.b,{between:!0},i.a.createElement("h1",null,null===r||void 0===r?void 0:r.name),i.a.createElement(M.a,{type:"link",onClick:function(){return a(!0)}},"\u521b\u5efa\u4efb\u52a1\u7ec4")),i.a.createElement(L.b,{locale:{emptyText:"\u6682\u65e0\u6570\u636e"},style:{overflow:"scroll"},dataSource:l,itemLayout:"vertical",renderItem:function(e){return i.a.createElement(L.b.Item,{key:e.id},i.a.createElement(L.b.Item.Meta,{title:i.a.createElement(m.b,{between:!0},i.a.createElement("span",null,null===e||void 0===e?void 0:e.name),i.a.createElement(M.a,{type:"link",onClick:function(){return t=e.id,void C.a.confirm({title:"\u786e\u8ba4\u5220\u9664\u9879\u76ee\u7ec4\u5417\uff1f",okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onOk:function(){s(t)}});var t}},"\u5220\u9664")),description:i.a.createElement("div",null,i.a.createElement("div",null,"\u5f00\u59cb\u65f6\u95f4\uff1a",R()(e.start).format("YYYY-MM-DD")),i.a.createElement("div",null,"\u7ed3\u675f\u65f6\u95f4\uff1a",R()(e.end).format("YYYY-MM-DD")))}),i.a.createElement("div",null,null===u||void 0===u?void 0:u.filter((function(t){return t.id===e.id})).map((function(e){return i.a.createElement(o.b,{key:e.id,to:"/projects/".concat(null===r||void 0===r?void 0:r.id,"/kanban?editTaskId=").concat(e.id)},e.name)}))))}}),i.a.createElement(B,{visible:n,onClose:function(){return a(!1)}}))}var q,J,U,W,_=function(e){var t=Object(p.c)();return Object(f.useQuery)(["kanbans",Object(v.a)(e)],(function(){return t("kanbans",{data:e})}))},$=n(175),G=n.p+"static/media/task.69774797.svg",X=n.p+"static/media/bug.5d8e8fd5.svg",Z=n(436),ee=n(448),te=n(440),ne=n(441),ae=function(e){var t=e.kanbanId,n=Object(c.useState)(""),a=Object(d.a)(n,2),r=a[0],l=a[1],o=k(),u=function(e){var t=Object(p.c)();return Object(f.useMutation)((function(e){return t("tasks",{method:"POST",data:e})}),Object(E.a)(e))}(x()).mutateAsync,m=Object(c.useState)(!1),s=Object(d.a)(m,2),b=s[0],v=s[1],O=function(){var e=Object(Y.a)(F.a.mark((function e(){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u({projectId:o,name:r,kanbanId:t});case 2:v(!1),l("");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=function(){return v((function(e){return!e}))};return Object(c.useEffect)((function(){b||l("")}),[b]),b?i.a.createElement(ee.a,null,i.a.createElement(H.a,{placeholder:"\u8bf7\u8f93\u5165\u521b\u5efa\u4efb\u52a1",onBlur:j,autoFocus:!0,value:r,onPressEnter:O,onChange:function(e){return l(e.target.value)}})):i.a.createElement(M.a,{type:"link",onClick:j},"+\u521b\u5efa\u4efb\u52a1")},re=n(439),ce=function(e){var t=e.children,n=Object($.a)(e,["children"]);return i.a.createElement(re.c,n,(function(e){return i.a.isValidElement(t)?i.a.cloneElement(t,Object(b.a)(Object(b.a)({},e.droppableProps),{},{ref:e.innerRef,provided:e})):i.a.createElement("div",null)}))},ie=i.a.forwardRef((function(e,t){var n,a=e.children,r=Object($.a)(e,["children"]);return i.a.createElement("div",Object.assign({ref:t},r),a,null===(n=r.provided)||void 0===n?void 0:n.placeholder)})),le=function(e){var t=e.children,n=Object($.a)(e,["children"]);return i.a.createElement(re.b,n,(function(e){return i.a.isValidElement(t)?i.a.cloneElement(t,Object(b.a)(Object(b.a)(Object(b.a)({},e.draggableProps),e.dragHandleProps),{},{ref:e.innerRef})):i.a.createElement("div",null)}))},oe=function(e){var t=e.task,n=w().startEdit,a=I().name;return i.a.createElement(ee.a,{key:t.id,style:{marginBottom:"0.5rem",cursor:"pointer"},onClick:function(){return n(t.id)}},i.a.createElement("div",{dangerouslySetInnerHTML:{__html:T(t.name,a)}}),i.a.createElement(ue,{id:t.typeId}))},ue=function(e){var t,n=e.id,a=Object(Z.a)().data,r=null===a||void 0===a||null===(t=a.find((function(e){return e.id===n})))||void 0===t?void 0:t.name;return r?i.a.createElement("img",{src:"task"===r?G:X,alt:"icon"}):null},de=Object(c.forwardRef)((function(e,t){var n=e.kanban,a=Object($.a)(e,["kanban"]),r=O(I()).data,c=null===r||void 0===r?void 0:r.filter((function(e){return e.kanbanId===n.id}));return i.a.createElement(se,Object.assign({},a,{ref:t}),i.a.createElement(m.b,{between:!0},i.a.createElement("h3",null,n.name),i.a.createElement(me,{kanban:n,key:n.id})),i.a.createElement(be,null,i.a.createElement(ce,{type:"ROW",direction:"vertical",droppableId:String(n.id)},i.a.createElement(ie,{style:{minHeight:"1rem"}},null===c||void 0===c?void 0:c.map((function(e,t){return i.a.createElement(le,{key:e.id,index:t,draggableId:"task"+e.id},i.a.createElement("div",null,i.a.createElement(oe,{key:e.id,task:e})))})))),i.a.createElement(ae,{kanbanId:n.id})))})),me=function(e){var t=e.kanban,n=function(e){var t=Object(p.c)();return Object(f.useMutation)((function(e){return t("kanbans/".concat(e),{method:"DELETE"})}),Object(E.b)(e))}(h()).mutate,a=i.a.createElement(te.a,null,i.a.createElement(te.a.Item,{key:"delete"},i.a.createElement(M.a,{type:"link",onClick:function(){C.a.confirm({title:"\u786e\u8ba4\u5220\u9664\u770b\u677f\u5417\uff1f",okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onOk:function(){n(t.id)}})}},"\u5220\u9664")));return i.a.createElement(ne.a,{overlay:a},i.a.createElement(M.a,{type:"link"},"..."))},se=u.a.div(q||(q=Object(r.a)(["\n  min-width: 25rem;\n  display: flex;\n  flex-direction: column;\n  border-radius: 6px;\n  padding: 0.7rem 0.7rem 1rem;\n  margin-right: 1.5rem;\n  background-color: rgba(244, 245, 247);\n"]))),be=u.a.div(J||(J=Object(r.a)(["\n  flex: 1;\n  overflow: scroll;\n  ::-webkit-scrollbar {\n    display: none;\n  }\n"]))),fe=de,ve=n(428),pe=function(){var e=I(),t=Object(j.a)();return i.a.createElement(m.b,{gap:!0,marginBottom:4},i.a.createElement(H.a,{style:{width:"20rem"},placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d",value:e.name,onChange:function(e){return t({name:e.target.value})}}),i.a.createElement(ve.b,{defaultOptionName:"\u7ecf\u529e\u4eba",value:e.processorId,onChange:function(e){return t({processorId:e})}}),i.a.createElement(ve.a,{defaultOptionName:"\u7c7b\u578b",value:e.typeId,onChange:function(e){return t({typeId:e})}}),i.a.createElement(M.a,{onClick:function(){t({name:void 0,typeId:void 0,processorId:void 0,tagId:void 0})}},"\u91cd\u7f6e"))},Ee=n(219),Oe=u.a.div(U||(U=Object(r.a)(["\n  min-width: 25rem;\n  display: flex;\n  flex-direction: column;\n  border-radius: 6px;\n  padding: 0.7rem 0.7rem 1rem;\n  margin-right: 1.5rem;\n  background-color: rgba(244, 245, 247);\n"]))),je=function(){var e=Object(c.useState)(""),t=Object(d.a)(e,2),n=t[0],a=t[1],r=k(),l=function(e){var t=Object(p.c)();return Object(f.useMutation)((function(e){return t("kanbans",{method:"POST",data:e})}),Object(E.a)(e))}(h()).mutateAsync,o=function(){var e=Object(Y.a)(F.a.mark((function e(){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l({name:n,projectId:r});case 2:a("");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return i.a.createElement(Oe,null,i.a.createElement(H.a,{placeholder:"\u8bf7\u8f93\u5165\u770b\u677f\u540d",size:"large",value:n,onPressEnter:o,onChange:function(e){return a(e.target.value)}}))},ke={labelCol:{span:8},wrapperCol:{span:16}},ge=function(){var e=A.a.useForm(),t=Object(d.a)(e,1)[0],n=w(),a=n.editTaskId,r=n.editTask,l=n.close,o=function(e){var t=Object(p.c)();return Object(f.useMutation)((function(e){return t("tasks/".concat(e.id),{method:"PATCH",data:e})}),Object(E.c)(e))}(x()),u=o.mutateAsync,m=o.isLoading,s=function(e){var t=Object(p.c)();return Object(f.useMutation)((function(e){return t("tasks/".concat(e),{method:"DELETE"})}),Object(E.b)(e))}(x()).mutate,v=function(){var e=Object(Y.a)(F.a.mark((function e(){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(Object(b.a)(Object(b.a)({},r),t.getFieldsValue()));case 2:l();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){t.setFieldsValue(r)}),[t,r]),i.a.createElement(C.a,{title:"\u7f16\u8f91\u4efb\u52a1",forceRender:!0,visible:!!a,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onOk:v,onCancel:function(){l(),t.resetFields()},confirmLoading:m},i.a.createElement(A.a,Object.assign({},ke,{initialValues:r,form:t}),i.a.createElement(A.a.Item,{label:"\u4efb\u52a1\u540d",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"}]},i.a.createElement(H.a,{placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"})),i.a.createElement(A.a.Item,{label:"\u7ecf\u529e\u4eba",name:"processorId"},i.a.createElement(ve.b,{defaultOptionName:"\u7ecf\u529e\u4eba"})),i.a.createElement(A.a.Item,{label:"\u7c7b\u578b",name:"typeId"},i.a.createElement(ve.a,{defaultOptionName:"\u7c7b\u578b"}))),i.a.createElement("div",{style:{textAlign:"right"}},i.a.createElement(M.a,{type:"link",onClick:function(){l(),C.a.confirm({title:"\u786e\u8ba4\u5220\u9664\u4efb\u52a1\u5417\uff1f",okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onOk:function(){s(Number(a))}})}},"\u5220\u9664")))};function ye(){Object(v.e)("\u770b\u677f\u5217\u8868");var e=g().data,t=_(y()),n=t.data,a=t.isLoading,r=O(I()).isLoading,c=we();return i.a.createElement(re.a,{onDragEnd:c},i.a.createElement(m.c,null,i.a.createElement("h1",null,null===e||void 0===e?void 0:e.name),i.a.createElement(pe,null),a||r?i.a.createElement(Ee.a,{size:"large"}):i.a.createElement(Te,null,i.a.createElement(ce,{type:"COLUMN",direction:"horizontal",droppableId:"kanban"},i.a.createElement(ie,{style:{display:"flex"}},null===n||void 0===n?void 0:n.map((function(e,t){return i.a.createElement(le,{key:e.id,draggableId:"kanban"+e.id,index:t},i.a.createElement(fe,{kanban:e,key:e.id}))})))),i.a.createElement(je,null)),i.a.createElement(ge,null)))}var he,Ie,xe,we=function(){var e=_(y()).data,t=function(e){var t=Object(p.c)();return Object(f.useMutation)((function(e){return t("kanbans/reorder",{data:e,method:"POST"})}),Object(E.d)(e))}(h()).mutate,n=function(e){var t=Object(p.c)();return Object(f.useMutation)((function(e){return t("tasks/reorder",{data:e,method:"POST"})}),Object(E.e)(e))}(x()).mutate,a=O(I()).data,r=void 0===a?[]:a;return Object(c.useCallback)((function(a){var c=a.source,i=a.destination,l=a.type;if(i){if("COLUMN"===l){var o=null===e||void 0===e?void 0:e[c.index].id,u=null===e||void 0===e?void 0:e[i.index].id;if(!o||!u||o===u)return;var d=i.index>c.index?"after":"before";t({fromId:o,referenceId:u,type:d})}if("ROW"===l){var m=+c.droppableId,s=+i.droppableId,b=r.filter((function(e){return e.kanbanId===m}))[c.index],f=r.filter((function(e){return e.kanbanId===s}))[i.index];if((null===b||void 0===b?void 0:b.id)===(null===f||void 0===f?void 0:f.id))return;n({fromId:null===b||void 0===b?void 0:b.id,referenceId:null===f||void 0===f?void 0:f.id,fromKanbanId:m,toKanbanId:s,type:m===s&&i.index>c.index?"after":"before"})}}}),[e,t,r,n])},Te=u.a.div(W||(W=Object(r.a)(["\n  display: flex;\n  overflow-x: scroll;\n  flex: 1;\n"])));function Ce(){var e=function(){var e=Object(l.g)().pathname.split("/");return e[e.length-1]}();return i.a.createElement(Me,null,i.a.createElement(Le,null,i.a.createElement(te.a,{mode:"inline",selectedKeys:[e]},i.a.createElement(te.a.Item,{key:"kanban"},i.a.createElement(o.b,{to:"kanban"},"\u770b\u677f")),i.a.createElement(te.a.Item,{key:"epic"},i.a.createElement(o.b,{to:"epic"},"\u4efb\u52a1\u7ec4")))),i.a.createElement(Ne,null,i.a.createElement(l.d,null,i.a.createElement(l.b,{path:"/kanban",element:i.a.createElement(ye,null)}),i.a.createElement(l.b,{path:"/epic",element:i.a.createElement(K,null)}),i.a.createElement(l.a,{to:"kanban",replace:!0}))))}var Me=u.a.div(he||(he=Object(r.a)(["\n  display: grid;\n  grid-template-columns: 16rem 1fr;\n  width: 100%;\n"]))),Le=u.a.div(Ie||(Ie=Object(r.a)(["\n  display: flex;\n  background-color: rgb(244, 245, 247);\n"]))),Ne=u.a.div(xe||(xe=Object(r.a)(["\n  display: flex;\n  box-shadow: -5px 0 5px -5px rgba(0, 0, 0, 0.1);\n  overflow: hidden;\n"])))}}]);